<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>The Bullwhip Effect - Supply Chain Simulation</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');
    
    * {
      font-family: 'Inter', sans-serif;
    }
    
    body {
      margin: 0;
      padding: 0;
      overflow-x: hidden;
    }
    
    .animate-pulse-slow {
      animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
    }
    
    @keyframes pulse {
      0%, 100% {
        opacity: 1;
      }
      50% {
        opacity: .5;
      }
    }
    
    .gradient-text {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .card-hover {
      transition: all 0.3s ease;
    }
    
    .card-hover:hover {
      transform: translateY(-4px);
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    }
    
    .loading-spinner {
      border: 3px solid #f3f3f3;
      border-top: 3px solid #3B82F6;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <!-- React and dependencies -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://unpkg.com/lucide-react@latest/dist/umd/lucide-react.js"></script>

  <!-- Game modules -->
  <script type="module">
    // Import all game modules
    import { GameEngine } from './game-engine.js';
    import { AnimationController } from './animation-controller.js';
    import { ChartManager } from './chart-manager.js';
    import { PlayerLogic } from './player-logic.js';
    import { ScoreCalculator } from './score-calculator.js';

    // Make them globally available for the React component
    window.GameEngine = GameEngine;
    window.AnimationController = AnimationController;
    window.ChartManager = ChartManager;
    window.PlayerLogic = PlayerLogic;
    window.ScoreCalculator = ScoreCalculator;
  </script>

  <!-- Main React component -->
  <script type="text/babel" data-type="module">
    const { useState, useEffect, useRef } = React;
    const { 
      Play, Info, User, TrendingUp, Package, Truck, Ship, Wheat, Store, 
      Factory, Warehouse, DollarSign, AlertCircle, CheckCircle, Lightbulb,
      BarChart, LineChart, Award, Target
    } = lucide;

    const BullwhipEffectGame = () => {
      const [gameState, setGameState] = useState('menu');
      const [playerName, setPlayerName] = useState(localStorage.getItem('bullwhipPlayerName') || '');
      const [showInstructions, setShowInstructions] = useState(false);
      const [currentRound, setCurrentRound] = useState(0);
      const [currentRole, setCurrentRole] = useState(null);
      const [gameEngine, setGameEngine] = useState(null);
      const [orderHistory, setOrderHistory] = useState([]);
      const [inventory, setInventory] = useState(0);
      const [pendingOrders, setPendingOrders] = useState([]);
      const [incomingShipments, setIncomingShipments] = useState([]);
      const [costs, setCosts] = useState({ stockout: 0, holding: 0, total: 0 });
      const [forecast, setForecast] = useState([]);
      const [orderQuantity, setOrderQuantity] = useState(0);
      const [processing, setProcessing] = useState(false);

      const ROLES = [
        { id: 'retailer', name: 'Retail Store', icon: Store, color: '#3B82F6' },
        { id: 'distributor', name: 'Distributor', icon: Truck, color: '#8B5CF6' },
        { id: 'wholesaler', name: 'Wholesaler', icon: Warehouse, color: '#EC4899' },
        { id: 'manufacturer', name: 'Brewery', icon: Factory, color: '#F59E0B' },
        { id: 'supplier', name: 'Barley Farm', icon: Wheat, color: '#10B981' }
      ];

      useEffect(() => {
        if (gameState === 'playing' && !gameEngine) {
          const engine = new window.GameEngine(ROLES, playerName);
          setGameEngine(engine);
          startNewRound(engine, 1);
        }
      }, [gameState]);

      const startGame = () => {
        if (playerName.trim()) {
          localStorage.setItem('bullwhipPlayerName', playerName);
          setGameState('playing');
          setCurrentRound(0);
          setCosts({ stockout: 0, holding: 0, total: 0 });
        }
      };

      const startNewRound = (engine, roundNum) => {
        setCurrentRound(roundNum);
        
        const role = engine.assignRandomRole(roundNum);
        setCurrentRole(role);
        
        const state = engine.getRoundState(roundNum, role.id);
        setInventory(state.inventory);
        setPendingOrders(state.pendingOrders);
        setIncomingShipments(state.incomingShipments);
        setOrderHistory(state.orderHistory);
        setForecast(engine.generateForecast(role.id, roundNum));
        setOrderQuantity(state.pendingOrders[0] || 0);
      };

      const placeOrder = (quantity) => {
        if (!gameEngine || processing) return;
        
        setProcessing(true);
        
        const result = gameEngine.processPlayerOrder(currentRole.id, quantity, currentRound);
        
        setInventory(result.newInventory);
        setCosts(prev => ({
          stockout: prev.stockout + result.stockoutCost,
          holding: prev.holding + result.holdingCost,
          total: prev.total + result.stockoutCost + result.holdingCost
        }));
        
        setTimeout(() => {
          setProcessing(false);
          if (currentRound < 20) {
            startNewRound(gameEngine, currentRound + 1);
          } else {
            setGameState('results');
          }
        }, 2000);
      };

      if (gameState === 'menu') {
        return <MenuScreen 
          playerName={playerName}
          setPlayerName={setPlayerName}
          startGame={startGame}
          showInstructions={showInstructions}
          setShowInstructions={setShowInstructions}
        />;
      }

      if (gameState === 'playing') {
        return <GameScreen
          currentRound={currentRound}
          currentRole={currentRole}
          inventory={inventory}
          pendingOrders={pendingOrders}
          incomingShipments={incomingShipments}
          orderHistory={orderHistory}
          forecast={forecast}
          costs={costs}
          placeOrder={placeOrder}
          roles={ROLES}
          orderQuantity={orderQuantity}
          setOrderQuantity={setOrderQuantity}
          processing={processing}
        />;
      }

      if (gameState === 'results') {
        return <ResultsScreen
          gameEngine={gameEngine}
          playerName={playerName}
          totalCosts={costs}
          roles={ROLES}
          onPlayAgain={() => {
            setGameState('menu');
            setGameEngine(null);
            setCurrentRound(0);
            setCosts({ stockout: 0, holding: 0, total: 0 });
          }}
        />;
      }
    };

    const MenuScreen = ({ playerName, setPlayerName, startGame, showInstructions, setShowInstructions }) => {
      return (
        <div className="min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 flex items-center justify-center p-4">
          <div className="max-w-2xl w-full bg-white rounded-2xl shadow-2xl p-8">
            <div className="text-center mb-8">
              <div className="inline-flex items-center justify-center w-20 h-20 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-full mb-4">
                <TrendingUp className="w-10 h-10 text-white" />
              </div>
              <h1 className="text-4xl font-bold text-gray-800 mb-2">The Bullwhip Effect</h1>
              <p className="text-lg text-gray-600">Supply Chain Simulation Game</p>
            </div>

            <div className="space-y-6">
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2 flex items-center gap-2">
                  <User className="w-4 h-4" />
                  Your Name
                </label>
                <input
                  type="text"
                  value={playerName}
                  onChange={(e) => setPlayerName(e.target.value)}
                  onKeyPress={(e) => e.key === 'Enter' && startGame()}
                  placeholder="Enter your name"
                  className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none transition-colors"
                />
              </div>

              <button
                onClick={startGame}
                disabled={!playerName.trim()}
                className="w-full bg-gradient-to-r from-blue-500 to-indigo-600 text-white py-4 rounded-lg font-semibold text-lg hover:from-blue-600 hover:to-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all flex items-center justify-center gap-2 shadow-lg"
              >
                <Play className="w-6 h-6" />
                Start Game
              </button>

              <button
                onClick={() => setShowInstructions(!showInstructions)}
                className="w-full border-2 border-gray-300 text-gray-700 py-3 rounded-lg font-semibold hover:bg-gray-50 transition-colors flex items-center justify-center gap-2"
              >
                <Info className="w-5 h-5" />
                {showInstructions ? 'Hide Instructions' : 'Show Instructions'}
              </button>

              {showInstructions && <InstructionsPanel />}
            </div>
          </div>
        </div>
      );
    };

    const InstructionsPanel = () => {
      return (
        <div className="bg-blue-50 rounded-lg p-6 space-y-4 border-2 border-blue-200">
          <h2 className="text-2xl font-bold text-gray-800 mb-4">How to Play</h2>
          
          <div className="space-y-3 text-gray-700">
            <div>
              <h3 className="font-semibold text-lg mb-1 flex items-center gap-2">
                <TrendingUp className="w-5 h-5 text-blue-600" />
                The Bullwhip Effect
              </h3>
              <p>Small fluctuations in retail demand cause increasingly larger fluctuations up the supply chain, creating inefficiencies and excess costs.</p>
            </div>

            <div>
              <h3 className="font-semibold text-lg mb-1 flex items-center gap-2">
                <Target className="w-5 h-5 text-blue-600" />
                Game Overview
              </h3>
              <p>Play 20 rounds, taking on different roles in the beer supply chain. Each role has unique challenges and perspectives.</p>
            </div>

            <div>
              <h3 className="font-semibold text-lg mb-1">Supply Chain Layers</h3>
              <ul className="list-disc list-inside ml-2 space-y-1">
                <li><strong>Retail Store:</strong> Receives customer orders</li>
                <li><strong>Distributor:</strong> Supplies the retail store</li>
                <li><strong>Wholesaler:</strong> Supplies the distributor</li>
                <li><strong>Brewery:</strong> Manufactures beer</li>
                <li><strong>Barley Farm:</strong> Grows raw materials</li>
              </ul>
            </div>

            <div>
              <h3 className="font-semibold text-lg mb-1 flex items-center gap-2">
                <Package className="w-5 h-5 text-blue-600" />
                Time Delays
              </h3>
              <ul className="list-disc list-inside ml-2 space-y-1">
                <li><strong>Orders:</strong> Take 1 round to reach upstream</li>
                <li><strong>Shipments:</strong> Take 2 rounds to reach downstream</li>
              </ul>
            </div>

            <div>
              <h3 className="font-semibold text-lg mb-1 flex items-center gap-2">
                <DollarSign className="w-5 h-5 text-blue-600" />
                Costs
              </h3>
              <ul className="list-disc list-inside ml-2 space-y-1">
                <li><strong>Stockout:</strong> $1 per unfulfilled unit</li>
                <li><strong>Holding:</strong> $0.50 per unit in inventory</li>
              </ul>
            </div>

            <div>
              <h3 className="font-semibold text-lg mb-1 flex items-center gap-2">
                <Award className="w-5 h-5 text-blue-600" />
                Your Goal
              </h3>
              <p>Minimize total costs by balancing inventory. You only see your own inventory - not others! Information asymmetry is a key challenge.</p>
            </div>
          </div>
        </div>
      );
    };

    const GameScreen = ({ 
      currentRound, currentRole, inventory, pendingOrders, incomingShipments, 
      orderHistory, forecast, costs, placeOrder, roles, orderQuantity, 
      setOrderQuantity, processing 
    }) => {
      if (!currentRole) return null;

      const RoleIcon = currentRole.icon;
      const incomingOrder = pendingOrders[0] || 0;

      return (
        <div className="min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 p-6">
          <div className="max-w-7xl mx-auto">
            {/* Header */}
            <div className="bg-white rounded-xl shadow-lg p-6 mb-6 flex items-center justify-between">
              <div>
                <h2 className="text-3xl font-bold text-gray-800 mb-1">Round {currentRound} / 20</h2>
                <div className="flex items-center gap-2 text-xl" style={{ color: currentRole.color }}>
                  <RoleIcon className="w-6 h-6" />
                  <span className="font-semibold">Playing as: {currentRole.name}</span>
                </div>
              </div>
              <div className="text-right">
                <div className="text-sm text-gray-600">Total Costs</div>
                <div className="text-3xl font-bold text-red-600">${costs.total.toFixed(2)}</div>
                <div className="text-xs text-gray-500 mt-1">
                  Stockout: ${costs.stockout.toFixed(2)} | Holding: ${costs.holding.toFixed(2)}
                </div>
              </div>
            </div>

            {/* Game Area */}
            <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
              {/* Supply Chain Visualization */}
              <div className="lg:col-span-2">
                <SupplyChainVisualization roles={roles} currentRole={currentRole} />
              </div>

              {/* Player Panel */}
              <div className="space-y-4">
                {/* Inventory */}
                <div className="bg-white rounded-xl shadow-lg p-6">
                  <h3 className="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
                    <Package className="w-5 h-5" />
                    Your Inventory
                  </h3>
                  <div className="text-center">
                    <div className="text-5xl font-bold text-blue-600 mb-2">{inventory}</div>
                    <div className="text-sm text-gray-600">units in stock</div>
                  </div>
                </div>

                {/* Pipeline */}
                <div className="bg-white rounded-xl shadow-lg p-6">
                  <h3 className="text-lg font-bold text-gray-800 mb-4">Pipeline</h3>
                  <div className="space-y-3">
                    <div>
                      <div className="text-sm text-gray-600 mb-1">Incoming Order</div>
                      <div className="text-2xl font-bold text-orange-600">{incomingOrder} units</div>
                    </div>
                    <div>
                      <div className="text-sm text-gray-600 mb-1">Expected Shipments</div>
                      <div className="text-2xl font-bold text-green-600">
                        {incomingShipments.reduce((a, b) => a + b, 0)} units
                      </div>
                    </div>
                  </div>
                </div>

                {/* Order History Mini Chart */}
                {orderHistory.length > 0 && (
                  <div className="bg-white rounded-xl shadow-lg p-6">
                    <h3 className="text-lg font-bold text-gray-800 mb-4">Order History</h3>
                    <SimpleLineChart data={orderHistory} color={currentRole.color} />
                  </div>
                )}

                {/* Forecast */}
                <div className="bg-blue-50 rounded-xl p-4 border-2 border-blue-200">
                  <h4 className="font-semibold text-blue-900 mb-2 flex items-center gap-2">
                    <Lightbulb className="w-4 h-4" />
                    AI Forecast
                  </h4>
                  <div className="text-sm text-blue-800">
                    Expected demand: <strong>{forecast[0] || '?'}-{forecast[1] || '?'} units</strong>
                  </div>
                </div>

                {/* Order Placement */}
                <div className="bg-gradient-to-br from-indigo-500 to-purple-600 rounded-xl shadow-lg p-6 text-white">
                  <h3 className="text-lg font-bold mb-4">Place Your Order</h3>
                  <div className="space-y-4">
                    <div>
                      <label className="block text-sm mb-2">Order Quantity</label>
                      <input
                        type="number"
                        min="0"
                        value={orderQuantity}
                        onChange={(e) => setOrderQuantity(Math.max(0, parseInt(e.target.value) || 0))}
                        disabled={processing}
                        className="w-full px-4 py-3 rounded-lg text-gray-800 font-semibold text-xl text-center disabled:opacity-50"
                      />
                    </div>
                    <button
                      onClick={() => placeOrder(orderQuantity)}
                      disabled={processing}
                      className="w-full bg-white text-indigo-600 py-3 rounded-lg font-bold text-lg hover:bg-gray-100 transition-colors shadow-lg disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"
                    >
                      {processing ? (
                        <>
                          <div className="loading-spinner"></div>
                          Processing...
                        </>
                      ) : (
                        <>
                          <CheckCircle className="w-6 h-6" />
                          Submit Order
                        </>
                      )}
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      );
    };

    const SupplyChainVisualization = ({ roles, currentRole }) => {
      return (
        <div className="bg-white rounded-xl shadow-lg p-8 min-h-[600px]">
          <h3 className="text-2xl font-bold text-gray-800 mb-6">Supply Chain Network</h3>
          
          <div className="relative">
            <svg width="100%" height="500" viewBox="0 0 800 500" style={{ overflow: 'visible' }}>
              {/* Connection lines */}
              <line x1="650" y1="80" x2="550" y2="170" stroke="#cbd5e1" strokeWidth="3" strokeDasharray="5,5" />
              <line x1="450" y1="220" x2="250" y2="185" stroke="#cbd5e1" strokeWidth="3" strokeDasharray="5,5" />
              <line x1="200" y1="250" x2="200" y2="340" stroke="#cbd5e1" strokeWidth="3" strokeDasharray="5,5" />
              <line x1="250" y1="380" x2="450" y2="380" stroke="#cbd5e1" strokeWidth="3" strokeDasharray="5,5" />

              {/* Nodes */}
              {[
                { id: 'supplier', x: 650, y: 50, Icon: Wheat, color: '#10B981', name: 'Barley Farm' },
                { id: 'manufacturer', x: 500, y: 200, Icon: Factory, color: '#F59E0B', name: 'Brewery' },
                { id: 'wholesaler', x: 200, y: 200, Icon: Warehouse, color: '#EC4899', name: 'Wholesaler' },
                { id: 'distributor', x: 200, y: 380, Icon: Truck, color: '#8B5CF6', name: 'Distributor' },
                { id: 'retailer', x: 500, y: 380, Icon: Store, color: '#3B82F6', name: 'Retail Store' }
              ].map(node => {
                const Icon = node.Icon;
                const isActive = currentRole?.id === node.id;
                
                return (
                  <g key={node.id}>
                    <foreignObject x={node.x - 60} y={node.y - 35} width="120" height="100">
                      <div className={`flex flex-col items-center ${isActive ? 'animate-pulse-slow' : ''}`}>
                        <div 
                          className="w-16 h-16 rounded-full flex items-center justify-center shadow-lg"
                          style={{ 
                            backgroundColor: isActive ? node.color : `${node.color}20`,
                            border: isActive ? `4px solid ${node.color}` : `2px solid ${node.color}`
                          }}
                        >
                          <Icon 
                            className="w-8 h-8" 
                            style={{ color: isActive ? '#fff' : node.color }}
                          />
                        </div>
                        <div className="text-center mt-2">
                          <div className="text-sm font-semibold text-gray-700">{node.name}</div>
                          {isActive && (
                            <div className="text-xs text-blue-600 font-bold mt-1">YOU</div>
                          )}
                        </div>
                      </div>
                    </foreignObject>
                  </g>
                );
              })}
            </svg>
          </div>
        </div>
      );
    };

    const SimpleLineChart = ({ data, color }) => {
      if (!data || data.length === 0) return <div className="text-gray-400 text-center py-4">No data</div>;

      const max = Math.max(...data, 10);
      const width = 280;
      const height = 100;
      
      const points = data.map((value, idx) => {
        const x = (idx / (data.length - 1 || 1)) * width;
        const y = height - (value / max) * (height - 10);
        return `${x},${y}`;
      }).join(' ');

      return (
        <svg width="100%" height={height} viewBox={`0 0 ${width} ${height}`}>
          <polyline
            points={points}
            fill="none"
            stroke={color}
            strokeWidth="2"
          />
          {data.map((value, idx) => {
            const x = (idx / (data.length - 1 || 1)) * width;
            const y = height - (value / max) * (height - 10);
            return (
              <circle
                key={idx}
                cx={x}
                cy={y}
                r="3"
                fill={color}
              />
            );
          })}
        </svg>
      );
    };

    const ResultsScreen = ({ gameEngine, playerName, totalCosts, roles, onPlayAgain }) => {
      if (!gameEngine) return null;

      const results = gameEngine.getFinalResults();
      const bullwhipMetrics = window.ScoreCalculator.calculateBullwhipMetrics(
        gameEngine.entities, 
        roles.map(r => r.id)
      );

      return (
        <div className="min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 p-6">
          <div className="max-w-6xl mx-auto">
            <div className="bg-white rounded-2xl shadow-2xl p-8 mb-6">
              <h1 className="text-4xl font-bold text-center text-gray-800 mb-2">Game Complete!</h1>
              <p className="text-center text-gray-600 mb-8">20 rounds finished</p>

              {/* Player Score */}
              <div className="bg-gradient-to-r from-blue-500 to-indigo-600 rounded-xl p-6 text-white mb-8">
                <h2 className="text-2xl font-bold mb-4 flex items-center gap-2">
                  <Award className="w-8 h-8" />
                  {playerName}'s Performance
                </h2>
                <div className="grid grid-cols-3 gap-4">
                  <div>
                    <div className="text-sm opacity-90">Total Costs</div>
                    <div className="text-3xl font-bold">${totalCosts.total.toFixed(2)}</div>
                  </div>
                  <div>
                    <div className="text-sm opacity-90">Stockout Costs</div>
                    <div className="text-2xl font-bold">${totalCosts.stockout.toFixed(2)}</div>
                  </div>
                  <div>
                    <div className="text-sm opacity-90">Holding Costs</div>
                    <div className="text-2xl font-bold">${totalCosts.holding.toFixed(2)}</div>
                  </div>
                </div>
              </div>

              {/* Rankings */}
              <div className="mb-8">
                <h3 className="text-2xl font-bold text-gray-800 mb-4 flex items-center gap-2">
                  <BarChart className="w-6 h-6" />
                  Supply Chain Rankings
                </h3>
                <div className="space-y-3">
                  {results.rankings.map((rank, idx) => {
                    const role = roles.find(r => r.id === rank.roleId);
                    const Icon = role?.icon;
                    
                    return (
                      <div key={idx} className="flex items-center justify-between p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors">
                        <div className="flex items-center gap-4">
                          <div className="text-2xl font-bold text-gray-400 w-8">#{idx + 1}</div>
                          {Icon && <Icon className="w-6 h-6" style={{ color: role.color }} />}
                          <div>
                            <div className="font-semibold text-gray-800">{rank.role}</div>
                            <div className="text-sm text-gray-600">
                              Responsibility: {rank.responsibilityScore} | Avg Inventory: {rank.avgInventory.toFixed(1)}
                            </div>
                          </div>
                        </div>
                        <div className="text-xl font-bold text-red-600">${rank.totalCost.toFixed(2)}</div>
                      </div>
                    );
                  })}
                </div>
              </div>

              {/* Bullwhip Analysis */}
              <div className="mb-8">
                <h3 className="text-2xl font-bold text-gray-800 mb-4 flex items-center gap-2">
                  <TrendingUp className="w-6 h-6" />
                  Bullwhip Effect Analysis
                </h3>
                <div className="bg-yellow-50 border-2 border-yellow-200 rounded-lg p-6">
                  <p className="text-gray-700 mb-4">
                    The Bullwhip Effect measures how much order variance amplifies as you move up the supply chain.
                  </p>
                  <div className="grid grid-cols-2 md:grid-cols-3 gap-4">
                    {Object.entries(bullwhipMetrics).map(([roleId, metrics]) => {
                      const role = roles.find(r => r.id === roleId);
                      return (
                        <div key={roleId} className="bg-white rounded-lg p-4">
                          <div className="font-semibold text-gray-800 mb-2">{role?.name}</div>
                          <div className="text-2xl font-bold" style={{ color: role?.color }}>
                            {metrics.bullwhipRatio.toFixed(2)}x
                          </div>
                          <div className="text-xs text-gray-600">variance ratio</div>
                        </div>
                      );
                    })}
                  </div>
                </div>
              </div>

              {/* Inventory Trends Chart */}
              <div className="mb-8">
                <h3 className="text-2xl font-bold text-gray-800 mb-4 flex items-center gap-2">
                  <LineChart className="w-6 h-6" />
                  Inventory Over Time
                </h3>
                <MultiLineChart 
                  datasets={roles.map(role => ({
                    label: role.name,
                    color: role.color,
                    data: results.inventoryHistory[role.id] || []
                  }))}
                />
              </div>

              {/* Play Again */}
              <button
                onClick={onPlayAgain}
                className="w-full bg-gradient-to-r from-blue-500 to-indigo-600 text-white py-4 rounded-lg font-bold text-lg hover:from-blue-600 hover:to-indigo-700 transition-all flex items-center justify-center gap-2 shadow-lg"
              >
                <Play className="w-6 h-6" />
                Play Again
              </button>
            </div>
          </div>
        </div>
      );
    };

    const MultiLineChart = ({ datasets }) => {
      if (!datasets || datasets.length === 0) return null;

      const width = 900;
      const height = 300;
      const padding = { top: 30, right: 100, bottom: 50, left: 50 };
      const chartWidth = width - padding.left - padding.right;
      const chartHeight = height - padding.top - padding.bottom;

      const allValues = datasets.flatMap(d => d.data);
      const max = Math.max(...allValues, 10);

      return (
        <div className="bg-gray-50 rounded-lg p-4 overflow-x-auto">
          <svg width={width} height={height} viewBox={`0 0 ${width} ${height}`}>
            {/* Grid */}
            <g opacity="0.1">
              {[0, 0.25, 0.5, 0.75, 1].map(ratio => (
                <line
                  key={ratio}
                  x1={padding.left}
                  y1={padding.top + chartHeight * (1 - ratio)}
                  x2={width - padding.right}
                  y2={padding.top + chartHeight * (1 - ratio)}
                  stroke="#000"
                  strokeWidth="1"
                />
              ))}
            </g>

            {/* Axes */}
            <line x1={padding.left} y1={padding.top} x2={padding.left} y2={height - padding.bottom} stroke="#666" strokeWidth="2" />
            <line x1={padding.left} y1={height - padding.bottom} x2={width - padding.right} y2={height - padding.bottom} stroke="#666" strokeWidth="2" />

            {/* Data lines */}
            {datasets.map((dataset, idx) => {
              const points = dataset.data.map((value, i) => {
                const x = padding.left + (i / (dataset.data.length - 1 || 1)) * chartWidth;
                const y = padding.top + chartHeight - (value / max) * chartHeight;
                return `${x},${y}`;
              }).join(' ');

              return (
                <polyline
                  key={idx}
                  points={points}
                  fill="none"
                  stroke={dataset.color}
                  strokeWidth="2.5"
                  opacity="0.8"
                />
              );
            })}

            {/* Legend */}
            {datasets.map((dataset, idx) => (
              <g key={idx} transform={`translate(${width - padding.right + 10}, ${padding.top + idx * 30})`}>
                <line x1="0" y1="0" x2="20" y2="0" stroke={dataset.color} strokeWidth="3" />
                <text x="25" y="5" className="text-sm fill-gray-700">{dataset.label}</text>
              </g>
            ))}

            {/* Y-axis labels */}
            {[max, max * 0.5, 0].map((value, idx) => (
              <text
                key={value}
                x={padding.left - 10}
                y={padding.top + chartHeight * (idx / 2)}
                textAnchor="end"
                alignmentBaseline="middle"
                className="text-xs fill-gray-600"
              >
                {Math.round(value)}
              </text>
            ))}
          </svg>
        </div>
      );
    };

    // Render the app
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<BullwhipEffectGame />);
  </script>
</body>
</html>
